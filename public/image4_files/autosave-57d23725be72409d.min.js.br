"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="65bf1162-8ecb-595d-8c86-07bf149b2dee")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[5817],{282688:(e,a,t)=>{t.d(a,{AX:()=>_,Ay:()=>d,DA:()=>v,DD:()=>s,Fz:()=>g,IC:()=>x,MV:()=>u,Ns:()=>y,O2:()=>m,QW:()=>A,Vw:()=>h,Vz:()=>r,dd:()=>c,eX:()=>n,fH:()=>p,hL:()=>f,ho:()=>i,jO:()=>N,ns:()=>w,r_:()=>E,rf:()=>o,yl:()=>l});let l="autosave_modal--modal--Egqg3",s="autosave_modal--title--Q-T-o",o="autosave_modal--body--pv4yP",n="autosave_modal--fileRows--JQWy9",i="autosave_modal--fileRow--vBNLB",c="autosave_modal--userRows--fG3Qq",r="autosave_modal--onlyFileRow--yr2jI autosave_modal--fileRow--vBNLB autosave_modal--body--pv4yP",u="autosave_modal--onlyFileRowText--NGT-7",m="autosave_modal--userTitle--lEP2M ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",d="autosave_modal--fileMetadata--JIecy",v="autosave_modal--fileTitle--L9HsU ellipsis--ellipsis--Tjyfa",f="autosave_modal--fileLastUpdatedAt--ZL15q ellipsis--ellipsis--Tjyfa text--fontPos11--2LvXf text--_fontBase--QdLsd",_="autosave_modal--logOutButtons--961-N",E="autosave_modal--logOutDiscard--MvTW-",g="autosave_modal--logOutDone--cjhVr autosave_modal--flexRowEnd--UaYDp",y="autosave_modal--doneAndSync---UvWx autosave_modal--flexRowEnd--UaYDp",N="autosave_modal--expiryAndDone--ck-oP",h="autosave_modal--done--F-hm3",p="autosave_modal--expiryWrapper--1Ee1U",x="autosave_modal--expiry--E2Ybr",A="autosave_modal--warningIcon--T1wLu",w="autosave_modal--openToSync--KQUfj"},275081:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLearnMoreModal:()=>m});var l=t(411855),s=t(188507),o=t(799569),n=t(946689),i=t(939863),c=t(662275),r=t(488578),u=t(282688);function m({userInOrg:e}){let a=(0,s.wA)();return l.createElement(r.aF,{className:u.yl},l.createElement(o.s_,{dispatch:a}),l.createElement("div",{className:u.DD},(0,i.tx)("autosave.learn_more.title")),l.createElement("div",{className:u.rf},(0,i.tx)("autosave.learn_more.body_save_pending_changes")),l.createElement("div",{className:u.rf},(0,i.tx)("autosave.learn_more.body_use_version_history")),l.createElement("div",{className:u.Fz},l.createElement(n.nR,{onClick:()=>{a(c.Ce())},className:u.Vw},(0,i.tx)("autosave.learn_more.done_button"))))}},714932:(e,a,t)=>{t.r(a),t.d(a,{AutosaveLogOutModal:()=>W,HasAutosaveChangesModal:()=>I});var l=t(411855),s=t(188507),o=t(459401),n=t(677469),i=t.n(n),c=t(297666),r=t(517333),u=t(737947),m=t(776621),d=t(304783),v=t(799569),f=t(946689),_=t(564577),E=t(574176),g=t(331737),y=t(89161),N=t(869381),h=t(762638),p=t(939863),x=t(119198),A=t(662275),w=t(788811),D=t(823699),k=t(63104),F=t(132367),b=t(860178),C=t(132135),O=t(565167),L=t(945020),M=t(754168),T=t(488578),R=t(282688),S=t(247866);function U(e){return e.user?l.createElement("div",{className:R.O2},l.createElement("p",null,e.user.community_profile_handle||e.user.email)):null}async function j(e,a){let t=!1,l=null;try{let{data:s}=await M.S.getFiles({includePerms:!0,fileKey:a.fileKey,args:{headers:{"X-Figma-User-ID":e}}});(l=s.meta)&&(l.deleted_at||!l.can_edit_canvas)&&(t=!0)}catch(e){404===e.status?t=!0:(0,m.Lo)("Autosave","Failed to retrieve information about autosave file")}return{userID:e,shouldDeleteFile:t,unsyncedFile:a,figFile:l}}let B=(e,a)=>(0,c.s)(()=>{let t=new URL((0,C.r1)(e,!0));t.searchParams.append("fuid",a),u.Ay.redirect(t.toString(),"_blank")}),z=(e,a)=>(0,c.s)(()=>e(x.NA({file:a,openNewFileIn:L.ai.NEW_TAB,source:O.U.AUTOSAVE_MODAL})));function V(e,a,t){return(0,k.y8)(a)?{fileName:a.file.name,onClick:B(a.file,t.id),thumbnail:l.createElement(g.H5,{file:a.file,size:N.y.SMALL,borderRadius:4})}:{fileName:a.name,onClick:z(e,a),thumbnail:l.createElement(y.A,{listView:"slightly-larger"})}}function P(e){let{fileName:a,onClick:t,thumbnail:o}=V((0,s.wA)(),e.fileState,e.user);return l.createElement("div",{className:R.ho,key:e.fileState.fileKey},l.createElement("div",{className:h.cx.hFull.$},o),l.createElement("div",{className:R.Ay},l.createElement("div",{className:R.DA},a),l.createElement("div",{className:R.hL},(0,p.tx)("tile.file_tile.edited_time",{time:l.createElement(_.h1,{date:e.fileState.lastUpdatedAt})}))),l.createElement(f.nR,{className:R.ns,onClick:t},(0,p.tx)("autosave.has_changes.open_to_sync")))}function G(e){return l.createElement("div",{className:R.dd},Object.keys(e.files).map(a=>l.createElement("div",{key:a,className:R.eX},l.createElement(U,{user:e.users.filter(e=>e?.id===a)[0]}),l.createElement("div",null,Object.values(e.files[a]).map(t=>l.createElement(P,{fileState:t,user:e.users.filter(e=>e?.id===a)[0],key:t.fileKey}))))))}function $(e,a,t,s,o,n){let c;let r=n||(()=>{e(A.Ce())}),u=H(t),m=1===i()(Object.values(a)).length,d=null,_=null,g=null,y=null,N=null;if(m){d=i()(Object.values(a))[0];let t=Object.keys(a).filter(e=>a[e].length>0)[0],o=V(e,d,_=s.filter(e=>e?.id===t)[0]);g=o.fileName,y=o.onClick,N=o.thumbnail,c=l.createElement("div",null,l.createElement(U,{user:_}),l.createElement("div",{className:R.Vz},l.createElement("div",{className:h.cx.hFull.$},N),l.createElement("div",{className:R.MV},(0,p.tx)("autosave.has_changes.unsaved_changes_to_file",{fileName:l.createElement("span",{className:R.DD},g)}))))}else c=l.createElement("div",null,l.createElement("div",{className:R.rf},(0,p.tx)("autosave.has_changes.unsynced_changes_offline")),l.createElement(G,{files:a,users:s}));return l.createElement(T.aF,{className:R.yl,size:500,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:e}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.has_changes.sync_offline_changes")),c,u||o||m?l.createElement("div",{className:R.jO},u&&l.createElement("div",{className:R.fH},l.createElement(E.B,{svg:S.A,className:R.QW}),l.createElement("div",{className:R.IC},u)),l.createElement("div",{className:R.Ns},o?l.createElement(f.nR,{onClick:r},(0,p.tx)("autosave.has_changes.dismiss.later")):null,m&&y&&l.createElement(f.$$,{onClick:y},(0,p.tx)("autosave.has_changes.open_to_sync")))):null)}function I(){let e=(0,s.wA)(),{unsyncedFiles:a,localUnsyncedFiles:t}=(0,w.Gg)(),l=(0,s.d4)(e=>e.modalShown),o=(0,s.d4)(e=>e.autosave.nextGarbageCollectionTimestamp),n=(0,b.iZ)(),i=n?.id;return l&&i&&n?$(e,{[i]:[...a,...t]},o,[n],!0):null}function K(e){let a=(0,s.wA)(),[t,o]=l.useState(!1),[n,i]=l.useState(!1),c=async()=>{try{for(let a of e.users){let e=a?.id;e&&await (0,w.go)((0,D.cu)(e))}}finally{i(!0)}},u=()=>{o(!0)};if(n)return l.createElement(T.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.logout.offline_changes")),l.createElement("div",{className:R.rf},(0,p.tx)("autosave.logout.offline_changes_discarded")),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out"))));if(0===Object.values(e.files).length&&e.loaded)return l.createElement(T.aF,{className:R.yl,size:384,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.logout.offline_changes")),l.createElement("div",{className:R.rf},(0,p.tx)("autosave.logout.offline_changes_synced")),l.createElement("div",{className:R.Vw},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out"))));if(t)return $(a,e.files,e.nextGarbageCollectionTimestamp,e.users,!1,()=>{o(!1)});{let t;let s=r.eD?(0,p.t)("autosave.logout.log_out_text.desktop"):(0,p.t)("autosave.logout.log_out_text.web");return t=r.eD?l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:c},(0,p.tx)("autosave.logout.discard_and_logout"))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:()=>{a(A.Lo())}},(0,p.tx)("autosave.logout.cancel")),l.createElement(f.nR,{onClick:u},(0,p.tx)("autosave.logout.show_changes")))):l.createElement("div",{className:R.AX},l.createElement("div",{className:R.r_},l.createElement(f.s6,{onClick:c},(0,p.tx)("autosave.logout.discard"))),l.createElement("div",{className:R.Fz},l.createElement(f.nR,{onClick:e.onLogOut},(0,p.tx)("autosave.logout.log_out")),l.createElement(f.$$,{onClick:u},(0,p.tx)("autosave.logout.sync_changes")))),l.createElement(T.aF,{className:R.yl,size:424,tintedModalBackground:!0},l.createElement(v.s_,{dispatch:a}),l.createElement("div",{className:R.DD},(0,p.tx)("autosave.has_changes.sync_offline_changes")),l.createElement("div",{className:R.rf},s),t)}}function W(e){let{multiUserUnsyncedFiles:a,multiUserGarbageCollectionTimestamp:t,loaded:n,autosaveFilesToDelete:i}=function(e){let a=(0,s.wA)(),[t,n]=l.useState({multiUserGarbageCollectionTimestamp:0,multiUserUnsyncedFiles:{},loaded:!1,autosaveFilesToDelete:[]});return l.useEffect(()=>{let a=async()=>{try{let a=await (0,w.ZW)((0,o.removeNullish)(e.map(e=>e?.id))),t={},l=[],s=[];for(let[e,l]of Object.entries(a)){for(let a of l.unsyncedFiles)s.push(j(e,a));for(let a of l.newFiles)e in t||(t[e]=[]),t[e].push(a)}for(let e of(await Promise.all(s))){let a=e.userID;e.shouldDeleteFile?l.push({userID:a,fileKey:e.unsyncedFile.fileKey}):e.figFile&&(a in t||(t[a]=[]),t[a].push({type:"autosave-file",fileKey:e.figFile.key,lastUpdatedAt:e.unsyncedFile.lastUpdatedAt,file:e.figFile}))}let i=Math.min(...Object.values(a).map(e=>e.nextGarbageCollectionTimestamp));n({multiUserGarbageCollectionTimestamp:i,multiUserUnsyncedFiles:t,loaded:!0,autosaveFilesToDelete:l})}catch(e){e instanceof Error?((0,m.x1)("Autosave","Failed to call autosave callback",{name:e.name,message:e.message}),(0,m.$D)(d.e.SCENEGRAPH_AND_SYNC,e)):(0,m.$D)(d.e.SCENEGRAPH_AND_SYNC,Error("Failed to call autosave callback"))}};return F.hp.register(F.a,a),a(),function(){F.hp.unregister(F.a,a)}},[a,e]),t}(e.users);return(0,b.TA)()?l.createElement(K,{loaded:n,nextGarbageCollectionTimestamp:t,files:a,onLogOut:()=>{for(let e of i)(0,w.go)((0,D.Zt)(e.userID,e.fileKey)).catch(e=>{(0,m.$D)(d.e.UNOWNED,Error("Failed to delete autosave data for sessions"))});e.onLogOut()},users:e.users}):null}I.displayName="HasAutosaveChangesModal";let H=e=>{let a=Math.floor(((0,w.bD)()-(Date.now()-e))/864e5);return a>5?null:a<1?(0,p.tx)("autosave.has_changes.expiry_text_shortly"):(0,p.tx)("autosave.has_changes.expiry_text_days",{days:a})};W.displayName="AutosaveLogOutModal"},528752:(e,a,t)=>{t.r(a),t.d(a,{AutosaveNewFileAlreadyOpenModal:()=>d});var l=t(411855),s=t(188507),o=t(776250),n=t(946689),i=t(762638),c=t(939863),r=t(662275),u=t(488578),m=t(282688);function d(e){let a=(0,s.wA)();return(0,l.useEffect)(()=>(0,o.sx)("New Autosave File Already Open Modal Shown")),l.createElement(u.aF,{size:360,tintedModalBackground:!0},l.createElement("div",{className:m.DD},(0,c.tx)("autosave.file_already_open_modal.title")),l.createElement("div",{className:m.rf},(0,c.tx)("autosave.file_already_open_modal.body",{fileName:l.createElement("span",{className:i.cx.fontSemiBold.$},e.file.name)})),l.createElement("div",{className:m.Vw},l.createElement(n.nR,{onClick:()=>a(r.Ce())},(0,c.tx)("general.ok"))))}d.displayName="AutosaveNewFileAlreadyOpenModal"}}]);

//# debugId=65bf1162-8ecb-595d-8c86-07bf149b2dee

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/2ad91fba139714194528b11b3ab2661a6e421be0/autosave-57d23725be72409d.min.js.map